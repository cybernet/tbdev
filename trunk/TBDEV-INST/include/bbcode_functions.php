<?php
$smilies = array(
  ":-)" => "smile1.gif",
  ":smile:" => "smile2.gif",
  ":-D" => "grin.gif",
  ":lol:" => "laugh.gif",
  ":w00t:" => "w00t.gif",
  ":-P" => "tongue.gif",
  ";-)" => "wink.gif",
  ":-|" => "noexpression.gif",
  ":-/" => "confused.gif",
  ":-(" => "sad.gif",
  ":'-(" => "cry.gif",
  ":weep:" => "weep.gif",
  ":-O" => "ohmy.gif",
  ":o)" => "clown.gif",
  "8-)" => "cool1.gif",
  "|-)" => "sleeping.gif",
  ":innocent:" => "innocent.gif",
  ":whistle:" => "whistle.gif",
  ":unsure:" => "unsure.gif",
  ":closedeyes:" => "closedeyes.gif",
  ":cool:" => "cool2.gif",
  ":fun:" => "fun.gif",
  ":thumbsup:" => "thumbsup.gif",
  ":thumbsdown:" => "thumbsdown.gif",
  ":blush:" => "blush.gif",
  ":unsure:" => "unsure.gif",
  ":yes:" => "yes.gif",
  ":no:" => "no.gif",
  ":love:" => "love.gif",
  ":?:" => "question.gif",
  ":!:" => "excl.gif",
  ":idea:" => "idea.gif",
  ":arrow:" => "arrow.gif",
  ":arrow2:" => "arrow2.gif",
  ":hmm:" => "hmm.gif",
  ":hmmm:" => "hmmm.gif",
  ":huh:" => "huh.gif",
  ":geek:" => "geek.gif",
  ":look:" => "look.gif",
  ":rolleyes:" => "rolleyes.gif",
  ":kiss:" => "kiss.gif",
  ":shifty:" => "shifty.gif",
  ":blink:" => "blink.gif",
  ":smartass:" => "smartass.gif",
  ":sick:" => "sick.gif",
  ":crazy:" => "crazy.gif",
  ":wacko:" => "wacko.gif",
  ":alien:" => "alien.gif",
  ":wizard:" => "wizard.gif",
  ":wave:" => "wave.gif",
  ":wavecry:" => "wavecry.gif",
  ":baby:" => "baby.gif",
  ":angry:" => "angry.gif",
  ":ras:" => "ras.gif",
  ":sly:" => "sly.gif",
  ":devil:" => "devil.gif",
  ":evil:" => "evil.gif",
  ":evilmad:" => "evilmad.gif",
  ":sneaky:" => "sneaky.gif",
  ":axe:" => "axe.gif",
  ":slap:" => "slap.gif",
  ":wall:" => "wall.gif",
  ":rant:" => "rant.gif",
  ":jump:" => "jump.gif",
  ":yucky:" => "yucky.gif",
  ":nugget:" => "nugget.gif",
  ":smart:" => "smart.gif",
  ":shutup:" => "shutup.gif",
  ":shutup2:" => "shutup2.gif",
  ":crockett:" => "crockett.gif",
  ":zorro:" => "zorro.gif",
  ":snap:" => "snap.gif",
  ":beer:" => "beer.gif",
  ":beer2:" => "beer2.gif",
  ":drunk:" => "drunk.gif",
  ":strongbench:" => "strongbench.gif",
  ":weakbench:" => "weakbench.gif",
  ":dumbells:" => "dumbells.gif",
  ":music:" => "music.gif",
  ":stupid:" => "stupid.gif",
  ":dots:" => "dots.gif",
  ":offtopic:" => "offtopic.gif",
  ":spam:" => "spam.gif",
  ":oops:" => "oops.gif",
  ":lttd:" => "lttd.gif",
  ":please:" => "please.gif",
  ":sorry:" => "sorry.gif",
  ":hi:" => "hi.gif",
  ":yay:" => "yay.gif",
  ":cake:" => "cake.gif",
  ":hbd:" => "hbd.gif",
  ":band:" => "band.gif",
  ":punk:" => "punk.gif",
	":rofl:" => "rofl.gif",
  ":bounce:" => "bounce.gif",
  ":mbounce:" => "mbounce.gif",
  ":thankyou:" => "thankyou.gif",
  ":gathering:" => "gathering.gif",
  ":hang:" => "hang.gif",
  ":chop:" => "chop.gif",
  ":rip:" => "rip.gif",
  ":whip:" => "whip.gif",
  ":judge:" => "judge.gif",
  ":chair:" => "chair.gif",
  ":tease:" => "tease.gif",
  ":box:" => "box.gif",
  ":boxing:" => "boxing.gif",
  ":guns:" => "guns.gif",
  ":shoot:" => "shoot.gif",
  ":shoot2:" => "shoot2.gif",
  ":flowers:" => "flowers.gif",
  ":wub:" => "wub.gif",
  ":lovers:" => "lovers.gif",
  ":kissing:" => "kissing.gif",
  ":kissing2:" => "kissing2.gif",
  ":console:" => "console.gif",
  ":group:" => "group.gif",
  ":hump:" => "hump.gif",
  ":hooray:" => "hooray.gif",
  ":happy2:" => "happy2.gif",
  ":clap:" => "clap.gif",
  ":clap2:" => "clap2.gif",
	":weirdo:" => "weirdo.gif",
  ":yawn:" => "yawn.gif",
  ":bow:" => "bow.gif",
	":dawgie:" => "dawgie.gif",
	":cylon:" => "cylon.gif",
  ":book:" => "book.gif",
  ":fish:" => "fish.gif",
  ":mama:" => "mama.gif",
  ":pepsi:" => "pepsi.gif",
  ":medieval:" => "medieval.gif",
  ":rambo:" => "rambo.gif",
  ":ninja:" => "ninja.gif",
  ":hannibal:" => "hannibal.gif",
  ":party:" => "party.gif",
  ":snorkle:" => "snorkle.gif",
  ":evo:" => "evo.gif",
  ":king:" => "king.gif",
  ":chef:" => "chef.gif",
  ":mario:" => "mario.gif",
  ":pope:" => "pope.gif",
  ":fez:" => "fez.gif",
  ":cap:" => "cap.gif",
  ":cowboy:" => "cowboy.gif",
  ":pirate:" => "pirate.gif",
  ":pirate2:" => "pirate2.gif",
  ":rock:" => "rock.gif",
  ":cigar:" => "cigar.gif",
  ":icecream:" => "icecream.gif",
  ":oldtimer:" => "oldtimer.gif",
	":trampoline:" => "trampoline.gif",
	":banana:" => "bananadance.gif",
  ":smurf:" => "smurf.gif",
  ":yikes:" => "yikes.gif",
  ":osama:" => "osama.gif",
  ":saddam:" => "saddam.gif",
  ":santa:" => "santa.gif",
  ":indian:" => "indian.gif",
  ":pimp:" => "pimp.gif",
  ":nuke:" => "nuke.gif",
  ":jacko:" => "jacko.gif",
  ":ike:" => "ike.gif",
  ":greedy:" => "greedy.gif",
	":super:" => "super.gif",
  ":wolverine:" => "wolverine.gif",
  ":spidey:" => "spidey.gif",
  ":spider:" => "spider.gif",
  ":bandana:" => "bandana.gif",
  ":construction:" => "construction.gif",
  ":sheep:" => "sheep.gif",
  ":police:" => "police.gif",
	":detective:" => "detective.gif",
  ":bike:" => "bike.gif",
	":fishing:" => "fishing.gif",
  ":clover:" => "clover.gif",
  ":horse:" => "horse.gif",
  ":shit:" => "shit.gif",
  ":soldiers:" => "soldiers.gif",
  ":blum:" => "blum.gif",
  ":congrat:" => "clapping2.gif",
  ":thedevil:" => "diablo.gif",
  ":drinks2:" => "drinks2.gif",
  ":rose:" => "give_rose.gif",
  ":good:" => "good.gif",
  ":hi2:" => "hi2.gif",
  ":pardon:" => "pardon.gif",
  ":rofl2:" => "rofl2.gif",
  ":spite:" => "spiteful.gif",
  ":unsure:" => "unknw.gif",
);



$privatesmilies = array(
  ":)" => "smile1.gif",
//  ";)" => "wink.gif",
  ":wink:" => "wink.gif",
  ":D" => "grin.gif",
  ":P" => "tongue.gif",
  ":(" => "sad.gif",
  ":'(" => "cry.gif",
  ":|" => "noexpression.gif",
  // "8)" => "cool1.gif",   we don't want this as a smilie...
  ":Boozer:" => "alcoholic.gif",
  ":deadhorse:" => "deadhorse.gif",
  ":spank:" => "spank.gif",
  ":yoji:" => "yoji.gif",
  ":locked:" => "locked.gif",
  ":grrr:" => "angry.gif", 			// legacy
  "O:-" => "innocent.gif",			// legacy
  ":sleeping:" => "sleeping.gif",	// legacy
  "-_-" => "unsure.gif",			// legacy
  ":clown:" => "clown.gif",
  ":mml:" => "mml.gif",
  ":rtf:" => "rtf.gif",
  ":morepics:" => "morepics.gif",
  ":rb:" => "rb.gif",
  ":rblocked:" => "rblocked.gif",
  ":maxlocked:" => "maxlocked.gif",
  ":hslocked:" => "hslocked.gif",
); 

$customsmilies = array(  
   ":fart:" => "fart.gif",
  ":fart2:" => "fart2.gif",
  ":lurker:" => "lurker.gif",
  ":blow:" => "badrazz.gif",
  ":jawdrop:" => "jawdrop.gif",
  ":sob:" => "sob.gif",
  ":whip2:" => "whip2.gif",
  ":geek2:" => "geek2.gif",
  ":madgrin:" => "mad-grin.gif",
  ":byebye:" => "connie_mini_byebye.gif",
  ":badrazz:" => "badrazz.gif",
  ":img:" => "img.gif",
  ":alcohol:" => "alcohol.gif",
  ":pmsl:" => "hysterical.gif",
  ":bombie:" => "bomb_ie.gif",
  ":whoops:" => "whoops.gif",
  ":banned:" => "banned.gif",
  ":faq:" => "faq.gif",
  ":iluvff:" => "iluvff.gif",
  ":starwars:" => "starwars.gif",
  ":mage:" => "mage.gif",
  ":respect:" => "respect.gif",
  ":utorrent:" => "utorrent.gif",
  ":spliffy:" => "spliffy.gif",
  ":bear:" => "bear.gif",
  ":bandit:" => "bandit.gif",
  ":congrats:" => "congrats.gif",
  ":smokin:" => "smokin.gif",
  ":canabis:" => "canabis.gif",
  ":2gun:" => "2gun.gif",
  ":bigun:" => "biggun.gif",
  ":chainsaw:" => "chainsaw2.gif",
  ":drinks:" => "drinks.gif",
  ":fight1:" => "fight1.gif",
  ":fight2:" => "fight2.gif",
  ":fight3:" => "fight3.gif",
  ":fight4:" => "fight4.gif",
  ":first:" => "first.gif",
  ":fight1:" => "fight1.gif",
  ":Gotcha:" => "Gotcha.gif",
  ":jumping:" => "jumping.gif",
  ":yoda:" => "yoda.gif",
  ":wink1:" => "wink1.gif",
  ":upyours:" => "upyours.gif",
  ":taz:" => "taz.gif",
  ":spew2:" => "spew2.gif",
  ":spew:" => "spew.gif",
  ":sniper1:" => "sniper1.gif",
  ":smokie2:" => "smokie2.gif",
  ":sick2:" => "sick2.gif",
  ":scream:" => "scream.gif",
  ":rasp2:" => "rasp2.gif",
  ":rasp:" => "rasp.gif",
  ":party8:" => "party8.gif",
  ":party7:" => "party7.gif", 
  ":party6:" => "party6.gif",
  ":party5:" => "party5.gif",
  ":party4:" => "party4.gif",
  ":party3:" => "party3.gif",
  ":party2:" => "party2.gif",
  ":party1:" => "party1.gif",
  ":oldman:" => "oldman.gif",
  ":ninja2:" => "ninja2.gif",
  ":madaRse:" => "madarse.gif",
  ":line:" => "Line.gif",
  ":last:" => "last.gif",
  ":kenny:" => "kenny.gif",
  ":jumping3:" => "jumping3.gif",
  ":jumping2:" => "jumping2.gif",
  ":jumping1:" => "jumping1.gif",
  ":pish:" => "pish.gif",
  ":grim:" => "grim.gif",
  ":taz2:" => "taz2.gif",
  ":spiderman:" => "spidey.gif",
  ":bong:" => "bong.gif",
  ":eye:" => "eye.gif",
  ":tumble:" => "tumbleweed.gif",
  ":welcome:" => "welcome.gif",
  ":fart3:" => "fart3.gif",
  );
$badwords = array("asshole" => "<img src=pic/censored.png>",
"Assshole" => "<img src=pic/censored.png>",
"ASSHOLE" => "<img src=pic/censored.png>",
"Fuck" => "<img src=pic/censored.png>",
"FUCK" => "<img src=pic/censored.png>",
"Cunt" => "<img src=pic/censored.png>",
"CUNT" => "<img src=pic/censored.png>",
"Bastard" => "<img src=pic/censored.png>",   
"BASTARD" => "<img src=pic/censored.png>",
"fcuk" => "<img src=pic/censored.png>",
"fook" => "<img src=pic/censored.png>",
"tosser" => "<img src=pic/censored.png>",
"Tosser" => "<img src=pic/censored.png>",
"fcck" => "<img src=pic/censored.png>",
"cnut" => "<img src=pic/censored.png>",
"Bollocks" => "<img src=pic/censored.png>",
"bollocks" => "<img src=pic/censored.png>",
"fucker" => "<img src=pic/censored.png>",
"Fucker" => "<img src=pic/censored.png>",
"Cunty" => "<img src=pic/censored.png>",
"cunty" => "<img src=pic/censored.png>",
"arseholes" => "<img src=pic/censored.png>",
"Arseholes" => "<img src=pic/censored.png>",
"Fuckwit" => "<img src=pic/censored.png>",
"fuckwit" => "<img src=pic/censored.png>",
"Shithead" => "<img src=pic/censored.png>",
"shithead" => "<img src=pic/censored.png>",
"Fuckface" => "<img src=pic/censored.png>",
"Motherfucker" => "<img src=pic/censored.png>",
"motherfucker" => "<img src=pic/censored.png>",
"Cock" => "<img src=pic/censored.png>",
"cock" => "<img src=pic/censored.png>",
"cocksucker" => "<img src=pic/censored.png>",
"shag" => "<img src=pic/censored.png>",
"WHORE" => "<img src=pic/censored.png>",
"dickhead" => "<img src=pic/censored.png>",
"Dickhead" => "<img src=pic/censored.png>",
"prick" => "<img src=pic/censored.png>",
"Prick" => "<img src=pic/censored.png>",
"faggot" => "<img src=pic/censored.png>",
"Faggot" => "<img src=pic/censored.png>",
"Crack" => "<img src=pic/censored.png>",
"Serial" => "<img src=pic/censored.png>",
"Keygen" => "<img src=pic/censored.png>",
"TiT" => "<img src=pic/censored.png>",
"Tit" => "<img src=pic/censored.png>",
"cvnt" => "<img src=pic/censored.png>",
"bar steward" => "<img src=pic/censored.png>",
"piss" => "<img src=pic/censored.png>",
"PISS" => "<img src=pic/censored.png>",
"FANNY" => "<img src=pic/censored.png>",
"Fanny" => "<img src=pic/censored.png>",
"fanny" => "<img src=pic/censored.png>",
"Bitch" => "<img src=pic/censored.png>",
"bitch" => "<img src=pic/censored.png>",
"Arse" => "<img src=pic/censored.png>",
"arse" => "<img src=pic/censored.png>",
"Fuckin" => "<img src=pic/censored.png>",
"fuckin" => "<img src=pic/censored.png>",
"fucking" => "<img src=pic/censored.png>",
"Fucking" => "<img src=pic/censored.png>",
"fuckface" => "<img src=pic/censored.png>",
"knob head" => "<img src=pic/censored.png>",
"fuckhead" => "<img src=pic/censored.png>",
"knob end" => "<img src=pic/censored.png>",
"fuck" => "<img src=pic/censored.png>",
"cunt" => "<img src=pic/censored.png>",
"Twat" => "<img src=pic/censored.png>",
"twat" => "<img src=pic/censored.png>",
"wanker" => "<img src=pic/censored.png>",
"bastard" => "<img src=pic/censored.png>",
"shit" => "<img src=pic/censored.png>",
"fvck" => "<img src=pic/censored.png>",
"Hoe" => "<img src=pic/censored.png>",
"FOOKIN" => "<img src=pic/censored.png>",
"FOOKING" => "<img src=pic/censored.png>",
"FOOK" => "<img src=pic/censored.png>",
"Ass" => "<img src=pic/censored.png>",
"ass wipe" => "<img src=pic/censored.png>",
"ass wipes" =>"<img src=pic/censored.png>",
);

function highlight_sql($string)
{
        $aKeywords = array(); 

        // SQL syntax
        $aKeywords[] = array('and', true); // keyword name (any string [a-zA-Z0-9_], or any character), keyword to next line (true or false, default: false), css class (default: 'keyword')
        $aKeywords[] = array('asc', false);
        $aKeywords[] = array('binary', false);
        $aKeywords[] = array('by', false);
        $aKeywords[] = array('delete', true);
        $aKeywords[] = array('desc', false);
        $aKeywords[] = array('having', true);
        $aKeywords[] = array('group', true);
        $aKeywords[] = array('insert', true);
        $aKeywords[] = array('in', true);
        $aKeywords[] = array('into', false);
        $aKeywords[] = array('left', false);
        $aKeywords[] = array('like', false);
        $aKeywords[] = array('limit', true);
        $aKeywords[] = array('order', true);
        $aKeywords[] = array('or', true);
        $aKeywords[] = array('right', false);
        $aKeywords[] = array('select', true);
        $aKeywords[] = array('table', true);
        $aKeywords[] = array('alter', true);
        $aKeywords[] = array('set', true);
        $aKeywords[] = array('values', true);
        $aKeywords[] = array('where', true);
        $aKeywords[] = array('xor', true);

        // Operators
        $aKeywords[] = array('+', false, 'operator');
        $aKeywords[] = array('-', false, 'operator');
        $aKeywords[] = array('*', false, 'operator');
        $aKeywords[] = array('/', false, 'operator');
        $aKeywords[] = array('%', false, 'operator');
        $aKeywords[] = array('.', false, 'operator');
        $aKeywords[] = array(',', false, 'operator');

        $aKeywords[] = array('true', false, 'red');
        $aKeywords[] = array('false', false, 'red');
        $aKeywords[] = array('null', false, 'red');
        $aKeywords[] = array('unkown', false, 'red');
        $aKeywords[] = array(';', false, 'red');
        
        $aKeywords[] = array('distinct', true, 'green');
        $aKeywords[] = array('as', false, 'green');
        $aKeywords[] = array('from', false, 'green');
        $aKeywords[] = array('join', false, 'green');
        
        $aKeywords[] = array('<', false, 'orange');
        $aKeywords[] = array('>', false, 'orange');
        $aKeywords[] = array('=', false, 'orange');
        $aKeywords[] = array('on', false, 'orange');
        $aKeywords[] = array('group', false, 'orange');

        // Split query into pieces (quoted values, ticked values, string and/or numeric values, and all others).
        $expr = '/(\'((\\\\.)|[^\\\\\\\'])*\')|(\`((\\\\.)|[^\\\\\\\`])*\`)|([a-z0-9_]+)|([\s\n]+)|(.)/i';
        preg_match_all($expr, $string, $matches);

        // Use a buffer to build up lines.
        $buffer = '';
        
        // Keep track of brackets to indent/outdent
        $iTab = 0;

        for($i = 0; $i < sizeof($matches[0]); $i++)
        {
            if(strcasecmp($match = $matches[0][$i], "") !== 0)
            {
                if(in_array($match, array("(", ")"))) // Bracket found
                {
                    $buffer = trim($buffer);

                    if(strlen($buffer) > 0)
                    {
                        $result .= $buffer . '<br>';
                    }

                    $buffer = '';

                    if(strcasecmp($match, ")") === 0)
                    {
                        $iTab--;

                        if($iTab < 0)
                        {
                            $iTab = 0;
                        }

                        $result .= str_repeat('&nbsp;', 4 * $iTab) . '<span class="bracket">' . htmlentities($match) . '</span><br>';
                    }
                    else // if(strcasecmp($match, "(") === 0)
                    {
                        $result .= str_repeat('&nbsp;', 4 * $iTab) . '<span class="bracket">' . htmlentities($match) . '</span><br>';
                        $iTab++;
                    }
                }
                elseif(preg_match('/^[\s\n]+$/', $match)) // Space character(s)
                {
                    if(strlen($buffer) === 0)
                    {
                        // Ignore space character(s)!
                    }
                    else
                    {
                        $buffer .= ' ';
                    }
                }
                else
                {
                    $aKeyword = false;

                    for($j = 0; $j < sizeof($aKeywords); $j++)
                    {
                        if(strcasecmp($match, $aKeywords[$j][0]) === 0)
                        {
                            $aKeyword = $aKeywords[$j];
                            break;
                        }
                    }

                    if($aKeyword) // Keyword found
                    {
                        if(isset($aKeyword[1]) && $aKeyword[1] === true) // Keyword to next line
                        {
                            $buffer = trim($buffer);

                            if(strlen($buffer) > 0)
                            {
                                $result .= $buffer . '<br>';
                            }

                            $buffer = ''; 
                        }

                        if(strlen($buffer) === 0) // Indent
                        {
                            $buffer .= str_repeat('&nbsp;', 4 * $iTab); 
                        }

                        $buffer .= '<span class="' . (isset($aKeyword[2]) ? $aKeyword[2] : 'keyword') . '">' . htmlentities(strtoupper($match)) . '</span>';
                    }
                    else
                    {
                        if(strlen($buffer) === 0) // Indent
                        {
                            $buffer = str_repeat('&nbsp;', 4 * $iTab);
                        }

                        if((strcasecmp(substr($match, 0, 1), "'") === 0) || is_numeric($match)) // Quoted value or number
                        {
                            $buffer .= '<span class="red">' . htmlentities($match) . '</span>';
                        }
                        elseif((strcasecmp(substr($match, 0, 1), "`") === 0) || preg_match('/[a-z0-9_]+/i', $match)) // Ticked value or unquoted string (table/column name?!)
                        {
                            $buffer .= '<span class="ticked">' . htmlentities($match) . '</span>';
                        }
                        else // All other chars
                        {
                            $buffer .= htmlentities($match);
                        }
                    }
                }
            }
        }

        $buffer = trim($buffer);

        if(strlen($buffer) > 0)
        {
            $result .= $buffer;
        }

        return '<div class="codetop">SQL</div><code class="sql">' . $result . '</code>';
}

function htmlspecialchars2( $s ) 
{ 
    static $patterns, $replaces; 
     
    if( !$patterns ){ 

        $patterns = array( '#&lt;#', '#&gt;#', '#&amp;#', '#&quot;#' );
        $replaces = array( '<', '>', '&', '"' ); 
    } 

    return preg_replace( $patterns, $replaces, $s ); 
}

function php( $test )
{
    $bTags = true;
    if (   ( strpos( $test, "<?" ) === false )
        && ( strpos( $test, "?>" ) === false ) ) {
        $test = "<?php".$test."?>";
        $bTags = false;
    }
    ob_start();
    highlight_string($test);
    $sRetVal = ob_get_contents();
    ob_end_clean();

    if ( $bTags == false ) {
        $sRetVal = str_replace( "&lt;?php", "", $sRetVal );
        $sRetVal = str_replace( "?&gt;", "", $sRetVal );
    }

    $sRetVal = str_replace( "\n", "", $sRetVal );
    $sRetVal = str_replace( "<br />", "", $sRetVal );

    return $sRetVal;
}

function highlight_html($code) { //HTML highlighting. Standard colors, or editable via Admin CP? Going standard at the moment 
     
        //coloring is a steady horse 
         
        // fikser highlight på vanlige tagger 
        $code = preg_replace("#&lt;(.+?)&gt;#is", "<span style=\"color:#000099;\">&lt;\\1&gt;</span>", $code);  
         
        // <a>-taggen 
        $code = preg_replace("#&lt;a(.+?)&gt;(.+?)&lt;/a&gt;#is", "<span style=\"color:#006600;\">&lt;a\\1&gt;</span>\\2<span style=\"color:#006600;\">&lt;/a&gt;</span>\n\r", $code);  
         
        // <img>-taggen 
        $code = preg_replace("#&lt;img(.+?)&gt;#is", "<span style=\"color:#990099;\">&lt;img\\1&gt;</span>", $code); 
         
        // <input>-taggen 
        $code = preg_replace("#&lt;input(.+?)&gt;#is", "<span style=\"color:#FF9900;\">&lt;input\\1&gt;</span>", $code); 
         
        // <style> 
        $code = preg_replace("#&lt;style&gt;(.+?)&lt;/style&gt;#is", "<span style=\"color:#990099;\">&lt;style&gt;</span>\\1<span style=\"color:#990099\">&lt;/style&gt;</span>", $code); 
         
        // <!-- og --> 
        $code = preg_replace("#&lt;!--(.+?)--&gt;#is", "<span style=\"color:#999999;\">&lt;!--\\1--&gt;</span>", $code); 
         
        // <script> med lukking 
        $code = preg_replace("#&lt;script(.+?)&gt;(.+?)&lt;/script&gt;#is", "<span style=\"color:#990000;\">&lt;script\\1&gt;</span>\\2<span style=\"color:#990000;\">&lt;/script&gt</span>", $code); 
         
        // <script> uten lukking 
        $code = preg_replace("#&lt;script(.+?)&gt;#is", "<span style=\"color:#990000;\">&lt;script\\1&gt;</span>", $code); 
         
        // <form> 
        $code = preg_replace("#&lt;form(.+?)&gt;#is", "<span style=\"color:#FF9900;\">&lt;form\\1&gt;</span>", $code); 
         
        // </form> 
        $code = preg_replace("#&lt;/form(.+?)&gt;#is", "<span style=\"color:#FF9900;\">&lt;/form\\1&gt;</span>", $code); 
         
        // atributter på vanlige tagger 
        function attr($match) { 
            return htmlspecialchars("<" . $match[1] . " ") 
            . preg_replace("#([a-z\-]+)=(&quot;.*?&quot;)($| |\n)#", "\\1=<span style=\"color:#0000FF;\">\\2</span>\\3", $match[2]) 
            . htmlspecialchars(">"); 
        } 
         
        $input = preg_replace_callback("#&lt;([a-z0-9]+) (([a-z\-]+=&quot;(.*?)&quot; *)*.*?)&gt;#is", 'attr', $input);  
         
        //indeed. 
        return $code; 
}

//Finds last occurrence of needle in haystack
//in PHP5 use strripos() instead of this
function _strlastpos ($haystack, $needle, $offset = 0)
{
	$addLen = strlen ($needle);
	$endPos = $offset - $addLen;
	while (true)
	{
		if (($newPos = strpos ($haystack, $needle, $endPos + $addLen)) === false) break;
		$endPos = $newPos;
	}
	return ($endPos >= 0) ? $endPos : false;
}
function format_urls($s)
{
return preg_replace(
   "/(\A|[^=\]'\"a-zA-Z0-9])((http|ftp|https|ftps|irc):\/\/[^<>\s]+)/i",
   "\\1<a target=_blank href=redir.php?url=\\2>\\2</a>", $s);
}
function format_quotes($s)
{
   preg_match_all('/\\[quote.*?\\]/', $s, $result, PREG_PATTERN_ORDER);
    $openquotecount = count($openquote = $result[0]);
   preg_match_all('/\\[\/quote\\]/', $s, $result, PREG_PATTERN_ORDER);
    $closequotecount = count($closequote = $result[0]);

   if ($openquotecount != $closequotecount) return $s; // quote mismatch. Return raw string...

   // Get position of opening quotes
    $openval = array();
   $pos = -1;

   foreach($openquote as $val)
 $openval[] = $pos = strpos($s,$val,$pos+1);

   // Get position of closing quotes
   $closeval = array();
   $pos = -1;

   foreach($closequote as $val)
       $closeval[] = $pos = strpos($s,$val,$pos+1);


   for ($i=0; $i < count($openval); $i++)
 if ($openval[$i] > $closeval[$i]) return $s; // Cannot close before opening. Return raw string...


    $s = str_replace("[quote]","<p class=sub><b>Quote:</b></p><table class=main border=1 cellspacing=0 cellpadding=10><tr><td style='border: 1px black dotted'>",$s);
   $s = preg_replace("/\\[quote=(.+?)\\]/", "<p class=sub><b>\\1 wrote:</b></p><table class=main border=1 cellspacing=0 cellpadding=10><tr><td style='border: 1px black dotted'>", $s);
   $s = str_replace("[/quote]","</td></tr></table><br>",$s);
   return $s;
}



function format_comment($text, $strip_html = true)
{
	global $smilies, $privatesmilies, $pic_base_url, $customsmilies, $CURUSER, $badwords;

	$s = $text;

  // This fixes the extraneous ;) smilies problem. When there was an html escaped
  // char before a closing bracket - like >), "), ... - this would be encoded
  // to &xxx;), hence all the extra smilies. I created a new :wink: label, removed
  // the ;) one, and replace all genuine ;) by :wink: before escaping the body.
  // (What took us so long? :blush:)- wyz

	$s = str_replace(";)", ":wink:", $s);
	
	if ($strip_html)
		$s = htmlspecialchars($s);
    
	// [*]
	$s = preg_replace("/\[\*\]/", "<li>", $s);

	// [b]Bold[/b]
	$s = preg_replace("/\[b\]((\s|.)+?)\[\/b\]/", "<b>\\1</b>", $s);

	// [i]Italic[/i]
	$s = preg_replace("/\[i\]((\s|.)+?)\[\/i\]/", "<i>\\1</i>", $s);

	// [u]Underline[/u]
	$s = preg_replace("/\[u\]((\s|.)+?)\[\/u\]/", "<u>\\1</u>", $s);

	// [u]Underline[/u]

     // the [you] tag
    $s = preg_replace("/\[you\]/i", $CURUSER['username'], $s);
	
    // Dynamic Vars
    $s = dynamic_user_vars($s); 

    $s = preg_replace("/\[u\]((\s|.)+?)\[\/u\]/i", "<u>\\1</u>", $s);
         
    $s = preg_replace( "#\[img\](.+?)\[/img\]#ie", "check_image('\\1')", $s );

    $s = preg_replace("/\[img\](http:\/\/[^\s'\"<>]+(\.(jpg|gif|png)))\[\/img\]/i", "<IMG border=\"0\" src=\"\\1\">", $s);
        
    $s = preg_replace("/\[img=(http:\/\/[^\s'\"<>]+(\.(gif|jpg|png)))\]/i", "<IMG border=\"0\" src=\"\\1\">", $s);
  
    // Video tag [video=url]
    // YouTube Vids
    $s = preg_replace("/\[video=[^\s'\"<>]*youtube.com.*v=([^\s'\"<>]+)\]/ims", "<object width=\"500\" height=\"410\"><param name=\"movie\" value=\"http://www.youtube.com/v/\\1\"></param><embed src=\"http://www.youtube.com/v/\\1\" type=\"application/x-shockwave-flash\" width=\"500\" height=\"410\"></embed></object>", $s);
    // Google Vids
    $s = preg_replace("/\[video=[^\s'\"<>]*video.google.com.*docid=(-?[0-9]+).*\]/ims", "<embed style=\"width:500px; height:410px;\" id=\"VideoPlayback\" align=\"middle\" type=\"application/x-shockwave-flash\" src=\"http://video.google.com/googleplayer.swf?docId=\\1\" allowScriptAccess=\"sameDomain\" quality=\"best\" bgcolor=\"#ffffff\" scale=\"noScale\" wmode=\"window\" salign=\"TL\"  FlashVars=\"playerMode=embedded\"> </embed>", $s);

    // [highlight]Highlight text[/highlight]
    $s = preg_replace("/\[highlight\]((\s|.)+?)\[\/highlight\]/", "<table border=0 cellspacing=0 cellpadding=1>".

    
                                                                                  "<tr><td bgcolor=green><b>\\1</b></td></tr>".
                                                                                    "</table>", $s);
// [ codebox]Some long text[/codebox ]
        $s = preg_replace(
    '/\[codebox\]\s*((\s|.)+?)\s*\[\/codebox\]\s*/i',
    '<div class="codetop">CODEBOX</div><div class="codemain" style="OVERFLOW: auto; WHITE-SPACE: pre; width: 100%; HEIGHT: 200px">\\1</div>', $s );
// [ code]Some long text[/code ]
        $s = preg_replace(
    '/\[code\]\s*((\s|.)+?)\s*\[\/code\]\s*/i',
    '<div class="codetop">CODE</div><div class="codemain" style="OVERFLOW: auto; WHITE-SPACE: pre; width: 100%; HEIGHT: 200px">\\1</div>', $s );

// [php]php code[/php]
$s = preg_replace( "/\[php\]((\s|.)+?)\[\/php\]/ise", "'<div class=\"codetop\">PHP</div><div class=\"codemain\">'.php(htmlspecialchars2('\\1')).'</div>'", $s );

// [html]html code[/html]

$s = preg_replace( "/\[html\]((\s|.)+?)\[\/html\]/ise", "'<div class=\"codetop\">HTML</div><div class=\"codemain\">'.highlight_html('\\1').'</div>'", $s );

// [s]Stroke[/s]
$s = preg_replace("/\[s\]((\s|.)+?)\[\/s\]/", "<s>\\1</s>", $s);

// [sql]Bold[/sql]

$s = preg_replace( "/\[sql\]((\s|.)+?)\[\/sql\]/ise", "''.highlight_sql(htmlspecialchars2('\\1')).''", $s );

  // [marquee]Marquee[/marquee]
    $s = preg_replace("/\[marquee\]((\s|.)+?)\[\/marquee\]/", "<marquee>\\1</marquee>", $s);

    // [blink]blink[/blink]
    $s = preg_replace("/\[blink\]((\s|.)+?)\[\/blink\]/", "<blink>\\1</blink>", $s);

    // [mcom]Text[/mcom]
   $s = preg_replace(
   "/\[mcom\]\s*((\s|.)+?)\s*\[\/mcom\]\s*/i",
   "<span style=\"font-size: 18pt; line-height: 50%;\">
   <div style=\"border-color: red; background-color: red; color: white; text-align: center; font-weight: bold; font-size: large;\">
   <b>\\1</b>
   </div>
   </span>", $s); 
   
   // [audio].mp3[/audio]
   $s = preg_replace(
   "/\[audio\]([^()<>\s]+?)\[\/audio\]/i",
   "<object type='application/x-shockwave-flash' data='flashplayer.swf' width='200' height='55'>
   <param name='movie' value='flashplayer.swf?src=\\1'>
   <param name='quality' value='high'>
   </object>", $s);

   // [color=blue]Text[/color]
	$s = preg_replace(
		"/\[color=([a-zA-Z]+)\]((\s|.)+?)\[\/color\]/i",
		"<font color=\\1>\\2</font>", $s);

	// [color=#ffcc99]Text[/color]
	$s = preg_replace(
		"/\[color=(#[a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9])\]((\s|.)+?)\[\/color\]/i",
		"<font color=\\1>\\2</font>", $s);
    // [url=http://www.example.com]Text[/url]
        $s = preg_replace(
                "/\[url=([^()<>\s]+?)\]((\s|.)+?)\[\/url\]/i",
                "<a href=$DEFAULTBASEURL/redir.php?url=\\1>\\2</a>", $s);
        // [url]http://www.example.com[/url]
        // Edited Sep 10 2006 hatamoto@hhole.com - limit URLs displayed to no larger than 60 characters, to kill sidescroll        
       // Of course people can still use the [url=http://somewhere.com]description[/url] format unchanged.
        while(preg_match("/\[url\]([^()<>\s]+?)\[\/url\]/i", $s, $match)) {
                $realurl = $match[1];
                $cleanurl = (strlen($realurl)>60) ? substr($realurl, 0, 60)."..." : $realurl;
                $s = preg_replace(
                        "/\[url\]([^()<>\s]+?)\[\/url\]/i",
                        "<a href=$DEFAULTBASEURL/redir.php?url=$realurl>$cleanurl</a>", $s, 1);
        }
	// [size=4]Text[/size]
	$s = preg_replace(
		"/\[size=([1-7])\]((\s|.)+?)\[\/size\]/i",
		"<font size=\\1>\\2</font>", $s);
		
	// [font=Arial]Text[/font]
	$s = preg_replace(
		"/\[font=([a-zA-Z ,]+)\]((\s|.)+?)\[\/font\]/i",
		"<font face=\"\\1\">\\2</font>", $s);
	// Quotes
	$s = format_quotes($s);
	// URLs
	 $s = format_urls($s);
    //$s = format_local_urls($s);
	// Linebreaks
	$s = nl2br($s);

	// [pre]Preformatted[/pre]
	$s = preg_replace("/\[pre\]((\s|.)+?)\[\/pre\]/i", "<tt><nobr>\\1</nobr></tt>", $s);

	// [nfo]NFO-preformatted[/nfo]
	$s = preg_replace("/\[nfo\]((\s|.)+?)\[\/nfo\]/i", "<tt><nobr><font face='MS Linedraw' size=2 style='font-size: 10pt; line-height: " .
		"10pt'>\\1</font></nobr></tt>", $s);

	// Maintain spacing
	$s = str_replace("  ", " &nbsp;", $s);
           
                // [hr=xxx]/[hr=xxx%]/[hr=xxxpt]/[hr=xxxpx]
                $s = preg_replace(
                "/\[hr(\=([0-9]{1,4})(%|px|pt)?)\]/i",
                "<hr align=center width=\"\\1\" />", $s);
                // [hr]
                $s = str_replace ("[hr]", "<hr>", $s);
                // [center]
                $s = preg_replace("/\[center\]((\s|.)+?)\[\/center\]/i", "<div align='center'><tt><nobr><font face='Verdana' size=2 style='font-size: 10pt; line-height: " .
                "10pt'>\\1</font></nobr></tt></div>", $s);       
                // [s]Stroke[/s]
                $s = preg_replace("/\[s\]((\s|.)+?)\[\/s\]/", "<s>\\1</s>", $s);  
	             
	reset($smilies);
	while (list($code, $url) = each($smilies))
	$s = str_replace($code, "<img border=0 src=\"{$pic_base_url}smilies/{$url}\" alt=\"" . htmlspecialchars($code) . "\">", $s);

	reset($privatesmilies);
	while (list($code, $url) = each($privatesmilies))
	$s = str_replace($code, "<img border=0 src=\"{$pic_base_url}smilies/{$url}\">", $s);
     
     reset($badwords);
     while (list($code, $url) = each($badwords))
     $s = str_replace($code, "$url", $s);
     
     reset($customsmilies);
     while (list($code, $url) = each($customsmilies))
	 $s = str_replace($code, "<img border=0 src=\"/pic/smilies/$url\" alt=\"" . htmlspecialchars($code) . "\">", $s);
	 return $s;
     }

//=== smilie function
function get_smile()
{
  global $CURUSER;
  return $CURUSER["smile_until"];
}

////////////new modified bbcode function - credits to original coder///////////////
function textbbcode($form,$text,$content="") {
?>
<script language=javascript>
var b_open = 0;
var i_open = 0;
var u_open = 0;
var marquee_open = 0;
var highlight_open = 0;
var blink_open = 0;
var php_open = 0;
var sql_open = 0;
var html_open = 0;
var codebox_open = 0;
var color_open = 0;
var list_open = 0;
var quote_open = 0;
var html_open = 0;
var mcom_open = 0;
var s_open = 0;
var myAgent = navigator.userAgent.toLowerCase();
var myVersion = parseInt(navigator.appVersion);

var is_ie = ((myAgent.indexOf("msie") != -1) && (myAgent.indexOf("opera") == -1));
var is_nav = ((myAgent.indexOf('mozilla')!=-1) && (myAgent.indexOf('spoofer')==-1)
&& (myAgent.indexOf('compatible') == -1) && (myAgent.indexOf('opera')==-1)
&& (myAgent.indexOf('webtv') ==-1) && (myAgent.indexOf('hotjava')==-1));

var is_win = ((myAgent.indexOf("win")!=-1) || (myAgent.indexOf("16bit")!=-1));
var is_mac = (myAgent.indexOf("mac")!=-1);
var bbtags = new Array();
function cstat() {
var c = stacksize(bbtags);
if ( (c < 1) || (c == null) ) {c = 0;}
if ( ! bbtags[0] ) {c = 0;}
document.<?=$form?>.tagcount.value = "Close last, Open tags "+c;
}
function stacksize(thearray) {
for (i = 0; i < thearray.length; i++ ) {
if ( (thearray[i] == "") || (thearray[i] == null) || (thearray == 'undefined') ) {return i;}
}
return thearray.length;
}
function pushstack(thearray, newval) {
arraysize = stacksize(thearray);
thearray[arraysize] = newval;
}
function popstackd(thearray) {
arraysize = stacksize(thearray);
theval = thearray[arraysize - 1];
return theval;
}
function popstack(thearray) {
arraysize = stacksize(thearray);
theval = thearray[arraysize - 1];
delete thearray[arraysize - 1];
return theval;
}
function closeall() {
if (bbtags[0]) {
while (bbtags[0]) {
tagRemove = popstack(bbtags)
if ( (tagRemove != 'color') ) {
doInsert("[/"+tagRemove+"]", "", false);
eval("document.<?=$form?>." + tagRemove + ".value = ' " + tagRemove + " '");
eval(tagRemove + "_open = 0");
} else {
doInsert("[/"+tagRemove+"]", "", false);
}
cstat();
return;
}
}
document.<?=$form?>.tagcount.value = "Close last, Open tags 0";
bbtags = new Array();
document.<?=$form?>.<?=$text?>.focus();
}
function add_code(NewCode) {
document.<?=$form?>.<?=$text?>.value += NewCode;
document.<?=$form?>.<?=$text?>.focus();
}
function alterfont(theval, thetag) {
if (theval == 0) return;
if(doInsert("[" + thetag + "=" + theval + "]", "[/" + thetag + "]", true)) pushstack(bbtags, thetag);
document.<?=$form?>.color.selectedIndex = 0;
cstat();
}
function tag_url() {
var FoundErrors = '';
var enterURL = prompt("You must enter a URL", "http://");
var enterTITLE = prompt("You must enter a title", "");
if (!enterURL || enterURL=="") {FoundErrors += " " + "You must enter a URL,";}
if (!enterTITLE) {FoundErrors += " " + "You must enter a title";}
if (FoundErrors) {alert("Error!"+FoundErrors);return;}
doInsert("[url="+enterURL+"]"+enterTITLE+"[/url]", "", false);
}
function tag_list() {
var FoundErrors = '';
var enterTITLE = prompt("Enter item of the list. For end of the list, press 'cancel' or leave the next field empty ", "");
if (!enterTITLE) {FoundErrors += " " + "Enter item of the list. For end of the list, press 'cancel' or leave the next field empty";}
if (FoundErrors) {alert("Error!"+FoundErrors);return;}
doInsert("[*]"+enterTITLE+"", "", false);

}
function tag_image() {
var FoundErrors = '';
var enterURL = prompt("You must enter a full image URL", "http://");
if (!enterURL || enterURL=="http://") {
alert("Error!"+"You must enter a full image URL");
return;
}
doInsert("[img]"+enterURL+"[/img]", "", false);
}
function tag_email() {
var emailAddress = prompt("You must enter a E-mail", "");
if (!emailAddress) {
alert("Error!"+"You must enter a E-mail");
return;
}
doInsert("[email]"+emailAddress+"[/email]", "", false);
}
function doInsert(ibTag, ibClsTag, isSingle)
{
var isClose = false;
var obj_ta = document.<?=$form?>.<?=$text?>;
if ( (myVersion >= 4) && is_ie && is_win) {
if(obj_ta.isTextEdit){
obj_ta.focus();
var sel = document.selection;
var rng = sel.createRange();
rng.colapse;
if((sel.type == "Text" || sel.type == "None") && rng != null){
if(ibClsTag != "" && rng.text.length > 0)
ibTag += rng.text + ibClsTag;
else if(isSingle) isClose = true;
rng.text = ibTag;
}
}
else{
if(isSingle) isClose = true;
obj_ta.value += ibTag;
}
} else {
if(isSingle) isClose = true;
obj_ta.value += ibTag;
}
obj_ta.focus();
// obj_ta.value = obj_ta.value.replace(/ /, " ");
return isClose;
}
function em(theSmilie)
{
doInsert(" " + theSmilie + " ", "", false);
}

function winop()
{
windop = window.open("moresmiles.php?form=<?=$form?>&text=<?=$text?>","mywin","height=400,width=450,resizable=yes,scrollbars=yes");
}

function winop2()
{
windop = window.open("moresmilies_custom.php?form=<?=$form?>&text=<?=$text?>","mywin","height=400,width=450,resizable=yes,scrollbars=yes");
}

function simpletag(thetag)
{
var tagOpen = eval(thetag + "_open");
if (tagOpen == 0) {
if(doInsert("[" + thetag + "]", "[/" + thetag + "]", true))
{
eval(thetag + "_open = 1");
eval("document.<?=$form?>." + thetag + ".value += '*'");
pushstack(bbtags, thetag);
cstat();
}
}
else {
lastindex = 0;
for (i = 0; i < bbtags.length; i++ ) {
if ( bbtags[i] == thetag ) {
lastindex = i;
}
}

while (bbtags[lastindex]) {
tagRemove = popstack(bbtags);
doInsert("[/" + tagRemove + "]", "", false)
if ((tagRemove != 'COLOR') ){
eval("document.<?=$form?>." + tagRemove + ".value = ' " + tagRemove + " '");
eval(tagRemove + "_open = 0");
}
}
cstat();
}
}
</script>
<?
print("<table width=600 cellspacing=0 cellpadding=5>\n");
?>
<td colSpan="2">
<table cellSpacing="1" cellPadding="2">
<tr>
<td class=embedded><input style="font-weight: bold;font-size:9px;" class=groovybutton2 type=button name="b" value="B" onClick="javascript: simpletag('b')" /></td>
<td class=embedded><input class=groovybutton2 style="font-style: italic;font-size:9px;"  type=button name="i" value="I" onClick="javascript: simpletag('i')" /></td>
<td class=embedded><input class=groovybutton2 style="text-decoration: underline;font-size:9px;" type=button name="u" value="U" onClick="javascript: simpletag('u')" /></td>
<? 
if (get_user_class() >= UC_POWER_USER) { ?>
<td class=embedded><input class=groovybutton2 style="text-decoration: s;font-size:9px;" type=button name="s" value="Stroke" onClick="javascript: simpletag('s')" /></td>
<td class=embedded><input class=groovybutton2 style="text-decoration: marquee;font-size:9px;" type=button name="marquee" value="Marquee" onClick="javascript: simpletag('marquee')" /></td>
<td class=embedded><input class=groovybutton2 style="text-decoration: highlight;font-size:9px;" type=button name="highlight" value="Highlight" onClick="javascript: simpletag('highlight')" /></td>
<td class=embedded><input class=groovybutton2 style="text-decoration: blink;font-size:9px;" type=button name="blink" value="Blink" onClick="javascript: simpletag('blink')" /></td>
<table cellSpacing="1" cellPadding="2">
<tr>
<? } ?>
<? 
if (get_user_class() >= UC_SYSOP) { ?>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="warning" value="Warning" onClick="javascript: simpletag('warning')" /></td>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="mcom" value="ModCom" onClick="javascript: simpletag('mcom')" /></td>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="php" value="Php" onClick="javascript: simpletag('php')" /></td>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="sql" value="Sql" onClick="javascript: simpletag('sql')" /></td>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="html" value="Html" onClick="javascript: simpletag('html')" /></td>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="codebox" value="Codebox" onClick="javascript: simpletag('codebox')" /></td>
<? } ?>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name='url' value='Url' onclick='tag_url()' />
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button  name="IMG" value="Img" onClick="javascript: tag_image()" /></td>
<td class=embedded><input type=button class=groovybutton2 style="font-size:9px;" name="list" value="List" onClick="tag_list()" /></td>
<td class=embedded><input class=groovybutton2 style="font-size:9px;" type=button name="quote" value="Quote" onClick="javascript: simpletag('quote')" /></td>
<td class=embedded><input style="width:180" style="font-size:9px;" class=groovybutton2 type=button onclick='javascript:closeall();' name='tagcount' value="Close all tags">
</table>
</td>

<table width=600 cellspacing=0 cellpadding=5>
<td colSpan="2">
<table cellSpacing="1" cellPadding="2">
<tr>
<td class=embedded><select name='color' class='codebuttons' onChange="alterfont(this.options[this.selectedIndex].value, 'color')">
<option value='0'>------ Color -------</option>
<option style="BACKGROUND-COLOR: black" value="Black">Black
</option>
<option style="BACKGROUND-COLOR: sienna" value="Sienna">
Sienna</option>
<option style="BACKGROUND-COLOR: darkolivegreen" value="DarkOliveGreen">
Dark Olive Green</option>
<option style="BACKGROUND-COLOR: darkgreen" value="DarkGreen">
Dark Green</option>
<option style="BACKGROUND-COLOR: darkslateblue" value="DarkSlateBlue">
Dark Slate Blue</option>
<option style="BACKGROUND-COLOR: navy" value="Navy">Navy
</option>
<option style="BACKGROUND-COLOR: indigo" value="Indigo">
Indigo</option>
<option style="BACKGROUND-COLOR: darkslategray" value="DarkSlateGray">
Dark Slate Gray</option>
<option style="BACKGROUND-COLOR: darkred" value="DarkRed">
Dark Red</option>
<option style="BACKGROUND-COLOR: darkorange" value="DarkOrange">
Dark Orange</option>
<option style="BACKGROUND-COLOR: olive" value="Olive">Olive
</option>
<option style="BACKGROUND-COLOR: green" value="Green">Green
</option>
<option style="BACKGROUND-COLOR: teal" value="Teal">Teal
</option>
<option style="BACKGROUND-COLOR: blue" value="Blue">Blue
</option>
<option style="BACKGROUND-COLOR: slategray" value="SlateGray">
Slate Gray</option>
<option style="BACKGROUND-COLOR: dimgray" value="DimGray">
Dim Gray</option>
<option style="BACKGROUND-COLOR: red" value="Red">Red
</option>
<option style="BACKGROUND-COLOR: sandybrown" value="SandyBrown">
Sandy Brown</option>
<option style="BACKGROUND-COLOR: yellowgreen" value="YellowGreen">
Yellow Green</option>
<option style="BACKGROUND-COLOR: seagreen" value="SeaGreen">
Sea Green</option>
<option style="BACKGROUND-COLOR: mediumturquoise" value="MediumTurquoise">
Medium Turquoise</option>
<option style="BACKGROUND-COLOR: royalblue" value="RoyalBlue">
Royal Blue</option>
<option style="BACKGROUND-COLOR: purple" value="Purple">
Purple</option>
<option style="BACKGROUND-COLOR: gray" value="Gray">Gray
</option>
<option style="BACKGROUND-COLOR: magenta" value="Magenta">
Magenta</option>
<option style="BACKGROUND-COLOR: orange" value="Orange">
Orange</option>
<option style="BACKGROUND-COLOR: yellow" value="Yellow">
Yellow</option>
<option style="BACKGROUND-COLOR: lime" value="Lime">Lime
</option>
<option style="BACKGROUND-COLOR: cyan" value="Cyan">Cyan
</option>
<option style="BACKGROUND-COLOR: deepskyblue" value="DeepSkyBlue">
Deep Sky Blue</option>
<option style="BACKGROUND-COLOR: darkorchid" value="DarkOrchid">
Dark Orchid</option>
<option style="BACKGROUND-COLOR: silver" value="Silver">
Silver</option>
<option style="BACKGROUND-COLOR: pink" value="Pink">Pink
</option>
<option style="BACKGROUND-COLOR: wheat" value="Wheat">Wheat
</option>
<option style="BACKGROUND-COLOR: lemonchiffon" value="LemonChiffon">
Lemon Chiffon</option>
<option style="BACKGROUND-COLOR: palegreen" value="PaleGreen">
Pale Green</option>
<option style="BACKGROUND-COLOR: paleturquoise" value="PaleTurquoise">
Pale Turquoise</option>
<option style="BACKGROUND-COLOR: lightblue" value="LightBlue">
Light Blue</option>
<option style="BACKGROUND-COLOR: plum" value="Plum">Plum
</option>
<option style="BACKGROUND-COLOR: white" value="White">White
</option>
</select>
<td class=embedded>
<select name='font' class='codebuttons' onChange="alterfont(this.options[this.selectedIndex].value, 'font')">
<option value='0'>--------- Font ---------</option>
<option value="Arial">Arial</option>
<option value="Arial Black">Arial Black</option>
<option value="Arial Narrow">Arial Narrow</option>
<option value="Book Antiqua">Book Antiqua</option>
<option value="Century Gothic">Century Gothic</option>
<option value="Comic Sans MS">Comic Sans MS</option>
<option value="Courier New">Courier New</option>
<option value="Fixedsys">Fixedsys</option>
<option value="Franklin Gothic Medium">Franklin Gothic
Medium</option>
<option value="Garamond">Garamond</option>
<option value="Georgia">Georgia</option>
<option value="Impact">Impact</option>
<option value="Lucida Console">Lucida Console</option>
<option value="Lucida Sans Unicode">Lucida Sans Unicode
</option>
<option value="Microsoft Sans Serif">Microsoft Sans Serif
</option>
<option value="Palatino Linotype">Palatino Linotype</option>
<option value="System">System</option>
<option value="Tahoma">Tahoma</option>
<option value="Times New Roman">Times New Roman</option>
<option value="Trebuchet MS">Trebuchet MS</option>
<option value="Verdana">Verdana</option>
</select>
<td class=embedded>
<select name='size' class='codebuttons' onChange="alterfont(this.options[this.selectedIndex].value, 'size')">
<option value='0'>- Size -</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
</select>
</select>
</table>
</td>
</tr>
<tr>
<td><textarea name="<?=$text?>" rows="15" cols="80"><? echo $content; ?></textarea>
</td>
<td>
<table cellSpacing="1" cellPadding="3">
<tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-)')">
<img border=0 src=pic/smilies/smile1.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':smile:')">
<img border=0 src=pic/smilies/smile2.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-D')">
<img border=0 src=pic/smilies/grin.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':w00t:')">
<img border=0 src=pic/smilies/w00t.gif width="18" height="20"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-P')">
<img border=0 src=pic/smilies/tongue.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(';-)')">
<img border=0 src=pic/smilies/wink.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-|')">
<img border=0 src=pic/smilies/noexpression.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-/')">
<img border=0 src=pic/smilies/confused.gif width="18" height="18"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-(')">
<img border=0 src=pic/smilies/sad.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':\'-(')">
<img border=0 src=pic/smilies/cry.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':-O')">
<img border=0 src=pic/smilies/ohmy.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em('|-)')">
<img border=0 src=pic/smilies/sleeping.gif width="20" height="27"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':innocent:')">
<img border=0 src=pic/smilies/innocent.gif width="18" height="22"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':unsure:')">
<img border=0 src=pic/smilies/unsure.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':closedeyes:')">
<img border=0 src=pic/smilies/closedeyes.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':cool:')">
<img border=0 src=pic/smilies/cool2.gif width="20" height="20"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':thumbsdown:')">
<img border=0 src=pic/smilies/thumbsdown.gif width="27" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':blush:')">
<img border=0 src=pic/smilies/blush.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':yes:')">
<img border=0 src=pic/smilies/yes.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':no:')">
<img border=0 src=pic/smilies/no.gif width="20" height="20"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':love:')">
<img border=0 src=pic/smilies/love.gif width="19" height="19"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':?:')">
<img border=0 src=pic/smilies/question.gif width="19" height="19"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':!:')">
<img border=0 src=pic/smilies/excl.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':idea:')">
<img border=0 src=pic/smilies/idea.gif width="19" height="19"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':arrow:')">
<img border=0 src=pic/smilies/arrow.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':arrow2:')">
<img border=0 src=pic/smilies/arrow2.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':hmm:')">
<img border=0 src=pic/smilies/hmm.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':hmmm:')">
<img border=0 src=pic/smilies/hmmm.gif width="25" height="23"></a></td></tr><tr>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':huh:')">
<img border=0 src=pic/smilies/huh.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':rolleyes:')">
<img border=0 src=pic/smilies/rolleyes.gif width="20" height="20"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':kiss:')">
<img border=0 src=pic/smilies/kiss.gif width="18" height="18"></a></td>
<td class=embedded style='padding: 2px; margin: 1px'><a href="javascript: em(':shifty:')">
<img border=0 src=pic/smilies/shifty.gif width="20" height="20"></a></td></tr>
<td class=embedded style='padding: 2px; margin: 1px' colspan="4" align="center">
</head>
<body bgcolor="#EDEDED" text="#000000" link="#000000" topmargin="0" leftmargin="0">
</table>
<center>
<a href="javascript:winop();">More Smiles</a>
<?php
if(get_smile() != '0000-00-00 00:00:00')
echo'<br><a href="javascript:winop2();">Custom Smilies</a>';
?>
</td></tr></table>
</td>
<?
}

function user_key_codes($key)
{
    return "/\[$key\]/i";
}

function dynamic_user_vars($text)
{
    global $CURUSER;
    // $zone = 0;        // GMT
    $zone = 3600*-5;    // EST
    $tim = time() + $zone;

    $cu=$CURUSER;
    // unset any variables ya dun want to display, or can't display
    unset($cu['old_password'],$cu['secret'],$cu['editsecret'],$cu['modcomment']);
    $bbkeys=array_keys($cu);
    $bbkeys[]='curdate';
    $bbkeys[]='curtime';
    $bbvals=array_values($cu);
    $bbvals[]=gmdate('F jS, Y',$tim);
    $bbvals[]=gmdate('g:i A',$tim);
    $bbkeys=array_map('user_key_codes',$bbkeys);
    return preg_replace($bbkeys,$bbvals,$text);
}
?>